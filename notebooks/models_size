{"cells":[{"cell_type":"markdown","metadata":{"id":"yg-ryckcYINL"},"source":["# Installing transformers package (and restarting the runtime)"]},{"cell_type":"code","execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":7570,"status":"ok","timestamp":1704645360048,"user":{"displayName":"Modafar Al-Shouha","userId":"08841682443665180805"},"user_tz":-60},"id":"OOVabZnWYPJ0","outputId":"42673e1c-040f-4057-f5b0-63b4a803e9ac"},"outputs":[{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: transformers[torch] in /usr/local/lib/python3.10/dist-packages (4.35.2)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.10/dist-packages (from transformers[torch]) (3.13.1)\n","Requirement already satisfied: huggingface-hub<1.0,>=0.16.4 in /usr/local/lib/python3.10/dist-packages (from transformers[torch]) (0.20.1)\n","Requirement already satisfied: numpy>=1.17 in /usr/local/lib/python3.10/dist-packages (from transformers[torch]) (1.23.5)\n","Requirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.10/dist-packages (from transformers[torch]) (23.2)\n","Requirement already satisfied: pyyaml>=5.1 in /usr/local/lib/python3.10/dist-packages (from transformers[torch]) (6.0.1)\n","Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.10/dist-packages (from transformers[torch]) (2023.6.3)\n","Requirement already satisfied: requests in /usr/local/lib/python3.10/dist-packages (from transformers[torch]) (2.31.0)\n","Requirement already satisfied: tokenizers<0.19,>=0.14 in /usr/local/lib/python3.10/dist-packages (from transformers[torch]) (0.15.0)\n","Requirement already satisfied: safetensors>=0.3.1 in /usr/local/lib/python3.10/dist-packages (from transformers[torch]) (0.4.1)\n","Requirement already satisfied: tqdm>=4.27 in /usr/local/lib/python3.10/dist-packages (from transformers[torch]) (4.66.1)\n","Requirement already satisfied: torch!=1.12.0,>=1.10 in /usr/local/lib/python3.10/dist-packages (from transformers[torch]) (2.1.0+cu121)\n","Collecting accelerate>=0.20.3 (from transformers[torch])\n","  Downloading accelerate-0.25.0-py3-none-any.whl (265 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m265.7/265.7 kB\u001b[0m \u001b[31m5.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: psutil in /usr/local/lib/python3.10/dist-packages (from accelerate>=0.20.3->transformers[torch]) (5.9.5)\n","Requirement already satisfied: fsspec>=2023.5.0 in /usr/local/lib/python3.10/dist-packages (from huggingface-hub<1.0,>=0.16.4->transformers[torch]) (2023.6.0)\n","Requirement already satisfied: typing-extensions>=3.7.4.3 in /usr/local/lib/python3.10/dist-packages (from huggingface-hub<1.0,>=0.16.4->transformers[torch]) (4.5.0)\n","Requirement already satisfied: sympy in /usr/local/lib/python3.10/dist-packages (from torch!=1.12.0,>=1.10->transformers[torch]) (1.12)\n","Requirement already satisfied: networkx in /usr/local/lib/python3.10/dist-packages (from torch!=1.12.0,>=1.10->transformers[torch]) (3.2.1)\n","Requirement already satisfied: jinja2 in /usr/local/lib/python3.10/dist-packages (from torch!=1.12.0,>=1.10->transformers[torch]) (3.1.2)\n","Requirement already satisfied: triton==2.1.0 in /usr/local/lib/python3.10/dist-packages (from torch!=1.12.0,>=1.10->transformers[torch]) (2.1.0)\n","Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests->transformers[torch]) (3.3.2)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests->transformers[torch]) (3.6)\n","Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests->transformers[torch]) (2.0.7)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests->transformers[torch]) (2023.11.17)\n","Requirement already satisfied: MarkupSafe>=2.0 in /usr/local/lib/python3.10/dist-packages (from jinja2->torch!=1.12.0,>=1.10->transformers[torch]) (2.1.3)\n","Requirement already satisfied: mpmath>=0.19 in /usr/local/lib/python3.10/dist-packages (from sympy->torch!=1.12.0,>=1.10->transformers[torch]) (1.3.0)\n","Installing collected packages: accelerate\n","Successfully installed accelerate-0.25.0\n"]}],"source":["!pip install transformers[torch]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"-bWra9i_YROy"},"outputs":[],"source":["# Restart Runtime\n","import os\n","os.kill(os.getpid(), 9)"]},{"cell_type":"markdown","metadata":{"id":"7-Yez_w1YI2-"},"source":["# Source files"]},{"cell_type":"code","execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":389,"status":"ok","timestamp":1704645368295,"user":{"displayName":"Modafar Al-Shouha","userId":"08841682443665180805"},"user_tz":-60},"id":"9o8RUb2WYL_V","outputId":"0addd5ac-8a49-432f-b653-294beccbcb2d"},"outputs":[{"output_type":"stream","name":"stdout","text":["/content/drive/MyDrive/PhD/OOD_VQA/Exps\n"]}],"source":["folder_path = \"/content/drive/MyDrive/PhD/OOD_VQA/Exps\"\n","%cd $folder_path"]},{"cell_type":"code","execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":3,"status":"ok","timestamp":1704645368295,"user":{"displayName":"Modafar Al-Shouha","userId":"08841682443665180805"},"user_tz":-60},"id":"-bgUb6u3Yw6F","outputId":"8c7fff44-d2ea-40e9-cc04-3455bd0ebcf3"},"outputs":[{"output_type":"stream","name":"stdout","text":["/content/drive/MyDrive/PhD/OOD_VQA/Exps\n"]}],"source":["!pwd"]},{"cell_type":"markdown","metadata":{"id":"0dkrG1svTvbc"},"source":["# Import"]},{"cell_type":"code","execution_count":3,"metadata":{"executionInfo":{"elapsed":947,"status":"ok","timestamp":1704645374136,"user":{"displayName":"Modafar Al-Shouha","userId":"08841682443665180805"},"user_tz":-60},"id":"XyW5DsPRTuEm"},"outputs":[],"source":["import numpy as np\n","import matplotlib.pyplot as plt\n","from textwrap import wrap\n","import math\n","import pandas as pd\n","from tqdm import tqdm\n","import os\n","import random\n","from utils import *"]},{"cell_type":"markdown","metadata":{"id":"kOXebgqzgWqh"},"source":["# Number of parameters"]},{"cell_type":"code","source":["def count_parameters(model):\n","    return sum(p.numel() for p in model.parameters() if p.requires_grad)"],"metadata":{"id":"MBfqdJKvye-6","executionInfo":{"status":"ok","timestamp":1704646709598,"user_tz":-60,"elapsed":4,"user":{"displayName":"Modafar Al-Shouha","userId":"08841682443665180805"}}},"execution_count":37,"outputs":[]},{"cell_type":"code","source":["model_type = \"VQA\"\n","\n","if model_type==\"VQA\":\n","  from vqa_class import *\n","elif model_type==\"IC\":\n","  from ic_class import *\n","\n","model_names = [\"GiT_base\", \"GiT_large\", \"Blip_base\", \"Blip_large\", \"Vilt\"]\n","\n","models_chkpts = {\n","    \"VQA\": {\n","        \"GiT_base\"  : {\"ckpt\": \"microsoft/git-base-vqav2\", \"class\":GiT},\n","        \"GiT_large\" : {\"ckpt\": \"microsoft/git-large-vqav2\", \"class\":GiT},\n","        \"Blip_base\" : {\"ckpt\": \"Salesforce/blip-vqa-base\", \"class\":Blip},\n","        \"Blip_large\": {\"ckpt\": \"Salesforce/blip-vqa-capfilt-large\", \"class\":Blip},\n","        \"Vilt\"      : {\"ckpt\": \"dandelin/vilt-b32-finetuned-vqa\", \"class\":Vilt}\n","    },\n","    \"IC\": {\n","        \"None\"      : {\"ckpt\": \"\", \"class\":None}\n","    }\n","}"],"metadata":{"id":"RBQdRV5g2h40","executionInfo":{"status":"ok","timestamp":1704646709985,"user_tz":-60,"elapsed":1,"user":{"displayName":"Modafar Al-Shouha","userId":"08841682443665180805"}}},"execution_count":38,"outputs":[]},{"cell_type":"code","source":["models = dict()\n","\n","for model_name in model_names:\n","  print(f\"Loading {model_name} model for {model_type}...\")\n","  model_class = models_chkpts[model_type][model_name][\"class\"]\n","  checkpoint = models_chkpts[model_type][model_name][\"ckpt\"]\n","  model = model_class(checkpoint)\n","  print(\"model loading is done!\")\n","  models[model_name] = model"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"ZSwZDyuE24WY","executionInfo":{"status":"ok","timestamp":1704647043185,"user_tz":-60,"elapsed":77015,"user":{"displayName":"Modafar Al-Shouha","userId":"08841682443665180805"}},"outputId":"eb3c5d8e-06b7-4ddd-e8ce-9eb0182fd060"},"execution_count":43,"outputs":[{"output_type":"stream","name":"stdout","text":["Loading GiT_base model for VQA...\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.10/dist-packages/huggingface_hub/utils/_token.py:72: UserWarning: \n","The secret `HF_TOKEN` does not exist in your Colab secrets.\n","To authenticate with the Hugging Face Hub, create a token in your settings tab (https://huggingface.co/settings/tokens), set it as secret in your Google Colab and restart your session.\n","You will be able to reuse this secret in all of your notebooks.\n","Please note that authentication is recommended but still optional to access public models or datasets.\n","  warnings.warn(\n"]},{"output_type":"stream","name":"stdout","text":["model loading is done!\n","Loading GiT_large model for VQA...\n","model loading is done!\n","Loading Blip_base model for VQA...\n","model loading is done!\n","Loading Blip_large model for VQA...\n","model loading is done!\n","Loading Vilt model for VQA...\n","model loading is done!\n"]}]},{"cell_type":"code","source":["for model_name in model_names:\n","  print(f\"{model_name}     \\t: {count_parameters(models[model_name].model)}\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"xpMDFyp7yFTi","executionInfo":{"status":"ok","timestamp":1704647064482,"user_tz":-60,"elapsed":409,"user":{"displayName":"Modafar Al-Shouha","userId":"08841682443665180805"}},"outputId":"32bfb624-747f-4a4d-8538-f50bc9cc8adb"},"execution_count":46,"outputs":[{"output_type":"stream","name":"stdout","text":["GiT_base     \t: 177159738\n","GiT_large     \t: 394855482\n","Blip_base     \t: 384672572\n","Blip_large     \t: 384672572\n","Vilt     \t: 117588537\n"]}]}],"metadata":{"colab":{"collapsed_sections":["7-Yez_w1YI2-"],"machine_shape":"hm","provenance":[],"mount_file_id":"1EgI-U__PMByWtPcZCEh80KmMM3hj3-yU","authorship_tag":"ABX9TyOf6DcupMwPqYnewnCDWXQu"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}